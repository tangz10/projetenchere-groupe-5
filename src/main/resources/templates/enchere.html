<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8">
  <title th:text="#{home.title}">Hello Tailwind</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>

<!--Navbar-->
<nav class="relative px-4 py-4 flex justify-between items-center bg-blue-600">
  <a th:href="@{/enchere}">
    <img class="h-[60px]" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSxn33FNU6y_diGg-jxsjb6JM6pT4WsHFDQBw&s" alt="">
  </a>
  <div class="lg:hidden">
    <button class="navbar-burger flex items-center text-white p-3">
      <svg class="block h-4 w-4 fill-current" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
        <title>Mobile menu</title>
        <path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"></path>
      </svg>
    </button>
  </div>
  <ul class="hidden absolute top-1/2 left-1/2 transform -translate-y-1/2 -translate-x-1/2 lg:flex lg:mx-auto lg:flex lg:items-center lg:w-auto lg:space-x-6">
    <li><a th:href="@{/enchere/add}" th:text="#{itemDetail.bid}" class="text-sm text-white font-bold" >Accueil</a></li>
    <li class="text-gray-300">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" class="w-4 h-4 current-fill" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v0m0 7v0m0 7v0m0-13a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
      </svg>
    </li>
    <li><a th:href="@{/my_profile}" th:text="#{header.profile}" class="text-sm text-white font-bold" >Accueil</a></li>

    <li sec:authorize="hasRole('ADMIN')" class="text-gray-300">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" class="w-4 h-4 current-fill" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v0m0 7v0m0 7v0m0-13a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
      </svg>
    </li>
    <li><a sec:authorize="hasRole('ADMIN')" th:href="@{/admin/users}" th:text="#{admin.configUsers}" class="text-sm text-white font-bold" >Accueil</a></li>
    <li sec:authorize="hasRole('ADMIN')" class="text-gray-300">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" class="w-4 h-4 current-fill" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v0m0 7v0m0 7v0m0-13a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
      </svg>
    </li>
    <li><a sec:authorize="hasRole('ADMIN')" th:href="@{/admin/categories}" th:text="#{admin.configCategories}" class="text-sm text-white font-bold" >Accueil</a></li>

  </ul>
  <form th:action="@{/logout}" method="post">
    <button type="submit" th:text="#{header.logout}" class="hidden lg:inline-block py-2 px-6 bg-white hover:bg-white/20 text-sm text-black font-bold rounded-xl transition duration-200" href="#">S'inscrire</button>
  </form>
</nav>
<div class="navbar-menu relative z-50 hidden">
  <div class="navbar-backdrop fixed inset-0 bg-gray-800 opacity-25"></div>
  <nav class="fixed top-0 left-0 bottom-0 flex flex-col w-5/6 max-w-sm py-6 px-6 bg-white border-r overflow-y-auto">
    <div class="flex items-center mb-8">
      <a th:href="@{/enchere}" class="mr-auto text-3xl font-bold leading-none" href="#">
        <img class="h-[60px]" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSxn33FNU6y_diGg-jxsjb6JM6pT4WsHFDQBw&s" alt="">
      </a>
      <button class="navbar-close">
        <svg class="h-6 w-6 text-gray-400 cursor-pointer hover:text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
    <div>
      <ul>
        <li class="text-gray-300">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" class="w-4 h-4 current-fill" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v0m0 7v0m0 7v0m0-13a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
          </svg>
        </li>
        <li><a th:href="@{/enchere/add}" th:text="#{itemDetail.bid}" class="text-sm text-blue-600 font-bold" >Accueil</a></li>
        <li class="text-gray-300">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" class="w-4 h-4 current-fill" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v0m0 7v0m0 7v0m0-13a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
          </svg>
        </li>
        <li><a th:href="@{/my_profile}" th:text="#{header.profile}" class="text-sm text-blue-600 font-bold" >Accueil</a></li>

        <li sec:authorize="hasRole('ADMIN')" class="text-gray-300">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" class="w-4 h-4 current-fill" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v0m0 7v0m0 7v0m0-13a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
          </svg>
        </li>
        <li><a sec:authorize="hasRole('ADMIN')" th:href="@{/admin/users}" th:text="#{admin.configUsers}" class="text-sm text-blue-600 font-bold" >Accueil</a></li>
        <li sec:authorize="hasRole('ADMIN')" class="text-gray-300">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" class="w-4 h-4 current-fill" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v0m0 7v0m0 7v0m0-13a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
          </svg>
        </li>
        <li><a sec:authorize="hasRole('ADMIN')" th:href="@{/admin/categories}" th:text="#{admin.configCategories}" class="text-sm text-blue-600 font-bold" >Accueil</a></li>

      </ul>
    </div>
    <div class="mt-auto">
      <div class="pt-6">
        <form th:action="@{/logout}" method="post">
          <button type="submit" th:text="#{header.logout}" class="lg:inline-block py-2 px-6 bg-blue-500 hover:bg-blue-600 text-sm text-white font-bold rounded-xl transition duration-200" href="#">S'inscrire</button>
        </form>
      </div>
    </div>
  </nav>
</div>




<!--Filtre-->
<div class="container mx-auto py-4 flex flex-col gap-4 mt-6">

  <div>
    <p class="font-bold text-white text-xl">Enchères disponible</p>
  </div>

  <div class="gap-4 bg-white rounded-xl py-4 px-4 border border-gray-300">
    <p th:text="#{home.filters}" class="font-bold">Filtes avancés</p>

    <form id="filterForm" method="get" class="p-4 space-y-6">
      <!-- Partie Achats -->
      <div class="flex items-start space-x-2">
        <input class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"
               type="radio"
               name="radioDefault"
               id="radioDefault2"
               onchange="window.location.href='/enchere/achats';"
               th:checked="${activeFilter == 'achats'}">
        <div class="text-sm">
          <label for="radioDefault2" class="font-bold text-blue-500 dark:text-gray-300" th:text="#{itemDetail.buy}">Achats</label>
        </div>
      </div>

      <ul class="space-y-2 pl-6">
        <li class="flex items-start space-x-2">
          <input class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600"
                 type="checkbox"
                 id="checkDefault1"
                 name="ouvertes"
                 onchange="document.getElementById('filterForm').submit();"
                 th:checked="${param.ouvertes != null}">
          <label for="checkDefault1" class="font-bold text-sm text-gray-700 dark:text-gray-300" th:text="#{itemDetail.buy.open}">enchères ouvertes</label>
        </li>
        <li class="flex items-start space-x-2">
          <input class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600"
                 type="checkbox"
                 id="checkDefault2"
                 name="AenCours"
                 onchange="document.getElementById('filterForm').submit();"
                 th:checked="${param.AenCours != null}">
          <label for="checkDefault2" class="font-bold text-sm text-gray-700 dark:text-gray-300" th:text="#{itemDetail.buy.live}">enchères en cours</label>
        </li>
        <li class="flex items-start space-x-2">
          <input class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600"
                 type="checkbox"
                 id="checkDefault3"
                 name="remportees"
                 onchange="document.getElementById('filterForm').submit();"
                 th:checked="${param.remportees != null}">
          <label for="checkDefault3" class="font-bold text-sm text-gray-700 dark:text-gray-300" th:text="#{itemDetail.buy.win}">enchères remportées</label>
        </li>
      </ul>

      <!-- Partie Ventes -->
      <div class="flex items-start space-x-2 mt-4">
        <input class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600"
               type="radio"
               name="radioDefault"
               id="radioDefault1"
               onchange="window.location.href='/enchere/mes-ventes';"
               th:checked="${activeFilter != null && activeFilter == 'ventes'}">
        <div class="text-sm">
          <label for="radioDefault1" class="font-bold text-blue-500 dark:text-gray-300" th:text="#{itemDetail.sell}">Mes ventes</label>
        </div>
      </div>

      <ul class="space-y-2 pl-6">
        <li class="flex items-start space-x-2">
          <input class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600"
                 type="checkbox"
                 id="checkVente1"
                 name="enCours"
                 onchange="document.getElementById('filterForm').submit();"
                 th:checked="${param.enCours != null}">
          <label for="checkVente1" class="text-sm font-bold text-gray-700 dark:text-gray-300" th:text="#{itemDetail.sell.live}">mes ventes en cours</label>
        </li>
        <li class="flex items-start space-x-2">
          <input class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600"
                 type="checkbox"
                 id="checkVente2"
                 name="nonDebutees"
                 onchange="document.getElementById('filterForm').submit();"
                 th:checked="${param.nonDebutees != null}">
          <label for="checkVente2" class="text-sm font-bold text-gray-700 dark:text-gray-300" th:text="#{itemDetail.sell.nostart}">ventes non débutées</label>
        </li>
        <li class="flex items-start space-x-2">
          <input class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600"
                 type="checkbox"
                 id="checkVente3"
                 name="terminees"
                 onchange="document.getElementById('filterForm').submit();"
                 th:checked="${param.terminees != null}">
          <label for="checkVente3" class="text-sm font-bold text-gray-700 dark:text-gray-300" th:text="#{itemDetail.sell.close}">ventes terminées</label>
        </li>
      </ul>
    </form>
  </div>

  <div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 bg-white rounded-xl py-4 px-4 border border-gray-300">
      <!-- Colonne 1 : Select Catégories -->
      <div>
        <form th:action="@{/enchere/filtrerParCategorie}" method="get">
          <label for="categories" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
                 th:text="#{home.categories}">Catégories</label>
          <select id="categories"
                  name="categorie"
                  class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg
                             focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5
                             dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400
                             dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                  onchange="this.form.submit()">
            <option th:value="0" th:text="#{home.allCategories}" th:selected="${categorieId == 0}">Toutes les catégories</option>
            <th:block th:each="categorie : ${categories}">
              <option th:value="${categorie.noCategorie}"
                      th:text="${categorie.libelle}"
                      th:selected="${categorie.noCategorie == categorieId}">
              </option>
            </th:block>
          </select>
        </form>
      </div>

      <!-- Colonne 2 : Input recherche -->
      <form th:action="@{/enchere/recherche}" method="get" class="grid grid-cols-2 gap-4">
        <div>
          <label for="searchQuery" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
                 th:text="#{home.searchPlaceholder}">Recherche une enchère</label>
          <input type="text"
                 id="searchQuery"
                 name="searchQuery"
                 class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg
                            focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5
                            dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400
                            dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                 th:placeholder="#{home.searchPlaceholder}">
        </div>

        <!-- Colonne 3 : Bouton de soumission -->
        <div class="flex items-end">
          <button type="submit"
                  class="w-full relative inline-flex items-center justify-center p-0.5 overflow-hidden
                             text-sm font-medium text-gray-900 rounded-lg group bg-gradient-to-br
                             from-cyan-500 to-blue-500 group-hover:from-cyan-500 group-hover:to-blue-500
                             hover:text-white dark:text-white focus:ring-4 focus:outline-none
                             focus:ring-cyan-200 dark:focus:ring-cyan-800">
                  <span class="relative w-full px-5 py-2.5 transition-all ease-in duration-75
                               bg-white dark:bg-gray-900 rounded-md group-hover:bg-transparent
                               group-hover:dark:bg-transparent"
                        th:text="#{home.searchButton}">Rechercher</span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <div>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-6 w-full">
      <div th:each="article : ${articleVendus}" class="relative mx-auto w-full ">
        <a th:href="@{/enchere/vente(id=${article.noArticle})}" class="relative border border-gray-300 inline-block duration-300 ease-in-out transition-transform transform hover:-translate-y-2 w-full">
          <div class="shadow p-4 rounded-lg bg-white">
            <div class="flex justify-center relative rounded-lg overflow-hidden h-52">
              <div class="transition-transform duration-500 transform ease-in-out hover:scale-110 w-full">
                <div class="absolute inset-0 bg-black ">
                  <img th:src="@{${article.url}}" alt="" style="height: -webkit-fill-available; width: -webkit-fill-available;">
                </div>
              </div>
            </div>

            <div class="mt-4">
              <h2 th:text="${article.nom_article}" class="font-medium text-base md:text-lg text-gray-800 line-clamp-1" title="New York">
                PC Gameur
              </h2>
              <p th:text="${article.noUtilisateur.rue + ' ' + article.noUtilisateur.codePostal + ' ' + article.noUtilisateur.ville}" class="mt-2 text-sm text-gray-800 line-clamp-1" title="New York, NY 10004, United States">
                Description
              </p>

              <br>
              <p th:text="#{itemDetail.endTime} + ': ' + ${article.fin_encheres}" class="mt-2 xl:mt-0 text-xs">
                Fin de l'enchère
              </p>
            </div>


            <div class="grid grid-cols-2 mt-8">
              <div class="flex items-center">
                <p th:text="${article.noUtilisateur.pseudo}" class="ml-2 text-gray-800 line-clamp-1">
                  Vendeur
                </p>
              </div>

              <div class="flex justify-end">
                <p class="inline-block font-semibold text-primary whitespace-nowrap leading-tight rounded-xl">
			  <span class="text-sm uppercase">
			  </span>
                  <span th:text="${article.prixInitial} + ' points'" class="text-lg">Prix</span>
                </p>
              </div>
            </div>
          </div>
        </a>
      </div>

    </div>
  </div>

  <ul class="flex justify-center gap-3 text-gray-900">
    <!-- Previous Button -->
    <li>
      <a
              th:href="@{${currentUrl}(page=${currentPage - 1})}"
              class="grid size-8 place-content-center rounded border bg-blue-600 text-white hover:text-black hover:border-gray-500 border-gray-200 transition-colors hover:bg-gray-50 rtl:rotate-180"
              aria-label="Previous page"
              th:classappend="${currentPage == 1} ? 'opacity-50 cursor-not-allowed'"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="size-4" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"/>
        </svg>
      </a>
    </li>

    <!-- Current Page and Total Pages -->
    <li class="text-sm/8 font-bold tracking-widest text-blue-600">
      <span th:text="${currentPage} + '/' + ${totalPages}"></span>
    </li>

    <!-- Next Button -->
    <li>
      <a
              th:href="@{${currentUrl}(page=${currentPage + 1})}"
              class="grid size-8 place-content-center bg-blue-600 text-white rounded border border-gray-200 transition-colors hover:bg-gray-50 hover:text-black hover:border hover:border-gray-500 rtl:rotate-180"
              aria-label="Next page"
              th:classappend="${currentPage == totalPages} ? 'opacity-50 cursor-not-allowed'"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="size-4" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
        </svg>
      </a>
    </li>
  </ul>


</div>

<!--Language-->
<form class="fixed bottom-4 right-4 max-w-sm mx-auto">
  <select th:value="${#locale.language}" onchange="changeLanguage(this.value)" id="countries" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
    <option value="fr" th:selected="${#locale.language == 'fr'}" th:text="#{lang.fr}" selected>FR</option>
    <option value="en" th:selected="${#locale.language == 'en'}" th:text="#{lang.en}">UK</option>
  </select>
</form>

</body>

</html>

<script>
  // Burger menus
  document.addEventListener('DOMContentLoaded', function() {
    // open
    const burger = document.querySelectorAll('.navbar-burger');
    const menu = document.querySelectorAll('.navbar-menu');

    if (burger.length && menu.length) {
      for (var i = 0; i < burger.length; i++) {
        burger[i].addEventListener('click', function() {
          for (var j = 0; j < menu.length; j++) {
            menu[j].classList.toggle('hidden');
          }
        });
      }
    }

    // close
    const close = document.querySelectorAll('.navbar-close');
    const backdrop = document.querySelectorAll('.navbar-backdrop');

    if (close.length) {
      for (var i = 0; i < close.length; i++) {
        close[i].addEventListener('click', function() {
          for (var j = 0; j < menu.length; j++) {
            menu[j].classList.toggle('hidden');
          }
        });
      }
    }

    if (backdrop.length) {
      for (var i = 0; i < backdrop.length; i++) {
        backdrop[i].addEventListener('click', function() {
          for (var j = 0; j < menu.length; j++) {
            menu[j].classList.toggle('hidden');
          }
        });
      }
    }
  });


  function changeLanguage(language) {
    const url = new URL(window.location.href);
    url.searchParams.set('lang', language);
    window.location.href = url.toString(); // redirection GET avec le paramètre
  }

</script>